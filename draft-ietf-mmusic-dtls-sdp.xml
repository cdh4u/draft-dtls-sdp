<?xml version="1.0" encoding="iso-8859-1"?>
<!-- comment -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd"[]>
<?rfc toc="yes" ?>
<?rfc compact="yes" ?>
<?rfc sortrefs="no" ?>
<rfc ipr="trust200902" category="std" docName="draft-ietf-mmusic-dtls-sdp-15.txt" updates="5763,7345" submissionType="IETF" xml:lang="en">
  <front>
    <title>
		Using the SDP Offer/Answer Mechanism for DTLS
	</title>
    <author fullname="Christer Holmberg" initials="C.H." surname="Holmberg">
        <organization abbrev="Ericsson">Ericsson</organization>
        <address>
            <postal>
                <street>Hirsalantie 11</street>
                <city>Jorvas</city>
                <region></region>
                <code>02420</code>
                <country>Finland</country>
            </postal>
            <phone></phone>
            <email>christer.holmberg@ericsson.com</email>
        </address>
    </author>
    <author fullname="Roman Shpount" initials="R.S." surname="Shpount">
        <organization abbrev="TurboBridge">TurboBridge</organization>
        <address>
            <postal>
                <street>4905 Del Ray Avenue, Suite 300</street>
                <city>Bethesda</city>
                <region>MD</region>
                <code>20814</code>
                <country>USA</country>
            </postal>
            <phone>+1 (240) 292-6632</phone>
            <email>rshpount@turbobridge.com</email>
        </address>
    </author>

    <date year="2016" />
    <area>RAI</area>
    <abstract>
		    <t>
            This document defines the SDP offer/answer procedures for negotiating and establishing
            a DTLS association. The document also defines the criteria for when a new DTLS association
            must be established. The document updates RFC 5763 and RFC 7345, by replacing common
            SDP offer/answer procedures with a reference to this specification.
        </t>
        <t>
            This document defines a new SDP media-level attribute, 'dtls-id'.
        </t>
    </abstract>
</front>
<middle>
    <section title="Introduction">
            <t>
                <xref format="default" pageno="false" target="RFC5763"/> defines SDP Offer/Answer
                procedures for SRTP-DTLS. <xref format="default" pageno="false" target="RFC7345"/>
                defines SDP offer/answer procedures for UDPTL-DTLS. This specification
                defines general offer/answer procedures for DTLS, based on the procedures in
                <xref format="default" pageno="false" target="RFC5763"/>. Other specifications,
                defining specific DTLS usages, can then reference this specification, in order
                to ensure that the DTLS aspects are common among all usages. Having common
                procedures is essential when multiple usages share the same
                DTLS association <xref target="I-D.ietf-mmusic-sdp-bundle-negotiation"/>.
                The document updates <xref format="default" pageno="false" target="RFC5763"/>
                and <xref format="default" pageno="false" target="RFC7345"/>, by replacing common
                SDP offer/answer procedures with a reference to this specification.
            </t>
            <t>
                As defined in <xref format="default" pageno="false" target="RFC5763"/>, a new DTLS association
                MUST be established when transport parameters are changed. Transport parameter change is not
                well defined when Interactive Connectivity Establishment (ICE) <xref format="default"
                pageno="false" target="I-D.ietf-ice-rfc5245bis"/> is used. One possible way to determine a transport change is
                based on ufrag change, but the ufrag value is changed both when ICE is negotiated
                and when ICE restart <xref format="default" pageno="false" target="I-D.ietf-ice-rfc5245bis"/> occurs. These events
                do not always require a new DTLS association to be established, but currently there is no way
                to explicitly indicate in an SDP offer or answer whether a new DTLS association is required.
                To solve that problem, this document defines a new SDP attribute, 'dtls-id'. The 'dtls-id' attribute
                pair  in combination with 'fingerprint' attribute values from offer and answer SDP uniquely
                identifies the DTLS association. Providing a new value of 'dtls-id' attribute in SDP offer
                or answers can be used to indicate whether a new DTLS association is to be established.
            </t>
    </section>

    <section title="Conventions">
		<t>
			The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
			"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
			document are to be interpreted as described in <xref target="RFC2119"></xref>.
		</t>
    </section>

    <section title="Establishing a new DTLS Association">
        <section title="General" anchor="sec-dtls-gen">
            <t>
                A new DTLS association MUST be established after an offer/answer transaction if:
                <list style="symbols">
					    <t>
                            DTLS setup roles negotiated as the result of the offer/answer transaction
                            are not 'holdconn';
					    </t>
					    <t>
                            As the result of the offer/answer transaction, negotiated DTLS setup roles changed;
					    </t>
                        <t>
                            One or more fingerprint values are modified, added
                            or removed in either offer or answer SDP; or
                        </t>
                        <t>
                            The intent to establish a new DTLS association is
                            explicitly signaled by changing the value of newly defined 'dtls-id' SDP attribute;
                        </t>
                </list>
            </t>
            <t>
                NOTE: The first three items list above are based on the procedures
                in <xref format="default" pageno="false" target="RFC5763"/>.
                This specification adds the support for explicit signaling via 'dtls-id' SDP attribute.
            </t>
            <t>
                A new DTLS association can only established as a result of the successful SDP offer/answer transaction.
                Whenever an entity determines that a new DTLS association is required, the entity MUST initiate an 
                SDP offer/answer transaction, following the procedures in <xref target="sec-oa"/>.
            </t>
            <t>
                Including SDP 'setup' attribute with the value 'holdconn' in either offer or answer prevents new DTLS
                association from being established. If 'holdconn' setup role is negotiated, new DTLS association MUST
                not be established and existing DTLS association MUST continue to be used.
            </t>
            <t>
                The sections below describe typical cases where a new DTLS association needs to be established.
            </t>
        </section>
        <section title="Change of Local Transport Parameters" anchor="sec-dtls-transport">
            <t>
                If an endpoint modifies its local transport parameters (address and/or port), and if the modification
                requires a new DTLS association, the endpoint MUST change its set of fingerprints and SDP 'dtls-id'
                attribute so that together they represent a new unique set of values <xref target="sec-dcon-attr"/>.
            </t>
            <t>
                If the underlying transport explicitly prohibits a DTLS association to span multiple transports, and if
                the transport is changed, the endpoint MUST change its set of fingerprints and SDP 'dtls-id'
                attribute so that together they represent a new unique set of values <xref target="sec-dcon-attr"/>.
                An example of such case is when DTLS is carried over SCTP, as described in
                <xref format="default" pageno="false" target="RFC6083"/>.
            </t>
        </section>
        <section title="Change of ICE ufrag value" anchor="sec-dtls-ufrag">
            <t>
                If an endpoint uses ICE, and modifies a local ufrag value, and if the modification
                requires a new DTLS association, the endpoint MUST change its set of fingerprints and SDP 'dtls-id'
                attribute so that together they represent a new unique set of values <xref target="sec-dcon-attr"/>.
            </t>
        </section>
    </section>
	<section title="SDP dtls-id Attribute" anchor="sec-dcon-attr">
        <t>
            The 'dtls-id' attribute pair  in combination with 'fingerprint' attribute values from offer and answer
            SDP uniquely identifies the DTLS association.
        </t>
        <figure>
		    <artwork align="left"><![CDATA[

       Name: dtls-id

       Value: dtls-id-value

       Usage Level: media

       Charset Dependent: no

       Default Value: empty value

       Syntax:

           dtls-id-value = 0*256 <alpha-numeric defined in [RFC4566]>

       Example:

           a=dtls-id:abc3dl

           	]]></artwork>
		</figure>
        <t>
            Every time end point requests to establish a new DTLS association using the same set of fingerprints,
            a new unique value of 'dtls-id' attribute is allocated. A combination of the previously used 'dtls-id'
            attribute in combination with the same fingerprint set indicates an intention to reuse the existing
            association.
        </t>
        <t>
            The default value for the SDP 'dtls-id' attribute is an empty value.
            Implementations that wish to use the attribute MUST explicitly include it
            in SDP offers and answers. If an offer or answer does not contain an
            attribute (this could happen if the offerer or answerer represents an
            existing implementation that has not been updated to support the attribute
            defined in this specification or an implementation which allocates a new
            temporary certificate for each association and uses change in fingerprint
            to indicate new association), it should be treated as if 'dtls-id' attribute
            with an empty value value were included in SDP and procedures defined in
            this specification should be used to determine if new DTLS association
            should be established.
        </t>
        <t>
            The mux category <xref target="I-D.ietf-mmusic-sdp-mux-attributes"/>
            for the 'dtls-id' attribute is 'IDENTICAL', which means that
            the attribute value must be identical across all media descriptions
            being multiplexed <xref target="I-D.ietf-mmusic-sdp-bundle-negotiation"/>.
        </t>
        <t>
            For RTP-based media, the 'dtls-id' attribute apply to whole associated
            media description. The attribute MUST NOT be defined per source (using the
            SDP 'ssrc' attribute <xref format="default" pageno="false" target="RFC5576"/>).
        </t>
        <t>
            The SDP offer/answer <xref format="default" pageno="false" target="RFC3264"/>
            procedures associated with the attribute are defined in <xref target="sec-oa"/>
        </t>
    </section>

    <section title="SDP Offer/Answer Procedures" anchor="sec-oa">
        <section title="General">
            <t>
                This section defines the generic SDP offer/answer procedures for negotiating
                a DTLS association. Additional procedures (e.g., regarding usage of specific SDP
                attributes etc) for individual DTLS usages (e.g., SRTP-DTLS) are outside the scope
                of this specification, and need to be specified in a usage specific specification.
            </t>
            <t>
                NOTE: The procedures in this section are generalizations of procedures first
                specified in SRTP-DTLS <xref format="default" pageno="false" target="RFC5763"/>,
                with the addition of usage of the SDP 'dtls-id' attribute. That document is
                herein updated to make use of these new procedures.
            </t>
            <t>
                The procedures in this section apply to an SDP media description ("m=" line) associated
                with DTLS-protected media/data.
           </t>
            <t>
                When an offerer or answerer indicates that it wants to establish a new DTLS association, it needs to make sure that
                media packets in the existing DTLS association and new DTLS association can be de-multiplexed. In case
                of ordered transport (e.g., SCTP) this can be done simply by sending packets for new DTLS association
                after all packets for existing DTLS association have been sent. In case of unordered transport, such as
                UDP, packets for the old DTLS association can arrive after the answer SDP was received and after first
                packets for the new DTLS association were received. The only way to de-multiplex packets belonging to
                old and new DTLS association is on the basis of transport 5-tuple. Because of this, if unordered transport
                is used for DTLS association, new transport (3-tuple) MUST be allocated by at least on the end points
                so that DTLS packets can be de-multiplexed.
            </t>
            <t>
                When an offerer needs to establish a new DTLS association, and if an unordered transport (e.g., UDP)
                is used, the offerer MUST allocate a new transport (3-tuple) for the offer in such a way that the offerer can
                disambiguate any packets associated with the new DTLS association from any packets associated with
                any other DTLS association. This typically means using a local address and/or port, or a set of
                ICE candidates (see <xref format="default" pageno="false" target="sec-dtls-reest-ice"/>), which were
                not recently used for any other DTLS association.
            </t>
            <t>
                When an answerer needs to establish a new DTLS association, if an unordered transport is used, and if
                the offerer did not allocate a new transport, the answerer MUST allocate a new transport for the offer
                in answer a way that it can disambiguate any packets associated with new DTLS association from any
                packets associated with any other DTLS association. This typically means using a local address and/or
                port, or a set of ICE candidates (see <xref format="default" pageno="false" target="sec-dtls-reest-ice"/>),
                which were not recently used for any other DTLS association.
            </t>
            <t>
                In order to negotiate a DTLS association, the following SDP attributes are used:
                <list style="symbols">
                    <t>
                        The SDP 'setup' attribute, defined in <xref target="RFC4145" pageno="false"
                        format="default" />, is used to negotiate the DTLS roles;
                    </t>
                    <t>
                        The SDP 'fingerprint' attribute, defined in <xref target="RFC4572"
                        pageno="false" format="default" />, is used to provide a fingerprint
                        values; and
                    </t>
                    <t>
                        The SDP 'dtls-id' attribute, defined in this specification, which, if fingerprints are
                        reused, can be assigned a new value to explicitly indicate the intention to establishing
                        a new DTLS association.
                    </t>
                </list>
            </t>
            <t>
                This specification does not define the usage of the SDP 'connection' attribute
                <xref target="RFC4145" pageno="false" format="default" /> for negotiating a DTLS
                connection. However, the attribute MAY be used if the DTLS association is used
                together with another protocol (e.g., SCTP or TCP) for which the usage of the
                attribute has been defined.
            </t>
            <t>
                Endpoints MUST support SHA-256 for generating and verifying any fingerprint
                value associated with the DTLS association. The use of SHA-256 is preferred.
            </t>
            <t>
                Endpoints MUST, at a minimum, support TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
                and MUST support TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256. UDPTL over DTLS MUST
                prefer TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 and any other Perfect Forward Secrecy
                (PFS) cipher suites over non-PFS cipher suites. Implementations SHOULD disable
                TLS-level compression.
            </t>
            <t>
                The certificate received during the DTLS handshake MUST match the certificate
                fingerprints received in SDP 'fingerprint' attributes according to procedures
                defined in <xref format="default" pageno="false" target="I-D.ietf-mmusic-4572-update"/>.
                If fingerprints do not match the hashed certificate, then an endpoint MUST tear
                down the media session immediately. Note that it is permissible to wait until
                the other side's fingerprint has been received before establishing the connection;
                however, this may have undesirable latency effects.
            </t>
            <t>
                SDP offerers and answerers might reuse certificates across multiple DTLS
                associations, and provide identical fingerprint values for each DTLS
                association. It MUST be ensured that the combination of the fingerprint values
                and the SDP 'dtls-id' attribute value is unique across all
                DTLS associations.
            </t>
            <t>
                If an SDP offerer or answerer generates a new temporary self-signed certificate for
                each new DTLS association, they can omit the SDP 'dtls-id' attribute.
            </t>
        </section>

        <section title="Generating the Initial SDP Offer" anchor="sec-oa-offer">
            <t>
                When an offerer sends the initial offer, the offerer MUST insert an SDP 'setup' attribute
                according to the procedures in <xref format="default" pageno="false" target="RFC4145"/>, and
                one or more SDP 'fingerprint' attributes according to the procedures in <xref format="default"
                pageno="false" target="RFC4572"/> and <xref format="default" pageno="false" target="I-D.ietf-mmusic-4572-update"/>.
                In addition, the offerer MUST insert in the offer an SDP 'dtls-id' attribute with a unique value
                for the offer fingerprint set. If the fingerprint set is not unique due the certificate reuse across
                multiple SDP sessions or endpoints, the 'dtls-id' attribute value MUST be generated in a way that
                guarantees uniqueness across all current DTLS association established using this fingerprint set,
                including DTLS association established by other SDP sessions or other endpoints.
            </t>
            <t>
                If the offerer inserts the SDP 'setup' attribute with an 'actpass' or 'passive' attribute value, the
                offerer MUST be prepared to receive a DTLS ClientHello message (if a new DTLS association
                is established by the answerer) from the answerer before the offerer receives the SDP answer.
            </t>
            <t>
                The offerer must not insert the SDP 'setup' attribute with the 'holdconn' attribute value in the
                initial offer since this will prevent DTLS association from being established.
            </t>
        </section>
        <section title="Generating the Answer">
            <t>
                When an answerer sends an answer, the answerer MUST insert in the answer an SDP 'setup' attribute
                according to the procedures in <xref format="default" pageno="false" target="RFC4145"/>, and one
                or more SDP 'fingerprint' attributes according to the procedures in <xref format="default" pageno="false" target="RFC4572"/>
                and <xref format="default" pageno="false" target="I-D.ietf-mmusic-4572-update"/>.
                If the answerer determines, based on the criteria specified in <xref target="sec-dtls-gen"/>,
                that a new DTLS association is to be established, the answerer MUST insert in the associated answer
                an SDP 'dtls-id' attribute with a unique value for the answer fingerprint set. If the fingerprint
                set is not unique due the certificate reuse across multiple SDP sessions or endpoints, 'dtls-id'
                value MUST be generated in a way that guarantees uniqueness across all current DTLS association
                established using this fingerprint set, including DTLS association established by other SDP
                sessions or other endpoints.
            </t>
            <t>
                If the answerer receives an offer that requires establishing a new DTLS association, no previous
                DTLS association exists, and if the answerer does not accept the establishment of a new DTLS
                association, the answerer MUST reject the "m=" lines associated with the suggested
                DTLS association <xref format="default" pageno="false" target="RFC3264"/>.
            </t>
            <t>
                If the answerer receives an offer that requires establishing a new DTLS association, a
                previous DTLS association exists, and if answerer does not accept the establishment of a 
                new DTLS association and decides to continue using a previous DTLS association,
                the answerer MUST reject establishing a new DTLS association by setting the SDP
                'setup' attribute value to 'holdconn'.
            </t>
            <t>
                If an answerer receives an offer that does not require to establish a new DTLS association,
                and if the answerer determines that a new DTLS association is not to be established,
                the answerer MUST insert an SDP 'dtls-id' attribute with the previously assigned value in the
                associated answer. In addition, the answerer MUST insert an SDP 'setup' attribute with a
                value that does not change the previously negotiated DTLS roles, and one or more SDP 'fingerprint'
                attributes values that do not change the previously sent fingerprints, in the answer.
            </t>
            <t>
                If the answerer receives an offer that does not contain an SDP 'dtls-id' attribute,
                the answerer MUST NOT insert a 'dtls-id' attribute in the answer.
            </t>
            <t>
                If a new DTLS association is to be established, and if the answerer inserts an SDP 'setup'
                attribute with an 'active' value in the answer, the answerer MUST initiate a DTLS handshake by
                sending a DTLS ClientHello message towards the offerer.
            </t>
            <t>
                If the answerer receives an offer that contains SDP 'setup' attribute with the value 'holdconn' 
                and no previous DTLS association exists the answerer MUST reject the "m=" lines associated with
                the suggested DTLS association <xref format="default" pageno="false" target="RFC3264"/>.
            </t>
        </section>
        <section title="Offerer Processing of the SDP Answer">
            <t>
                When an offerer receives an answer that either establishes a new DTLS association based on
                criteria defined in <xref target="sec-dtls-gen"/>, and if the offerer
                becomes DTLS client (based on the value of the SDP 'setup' attribute value
                <xref format="default" pageno="false" target="RFC4145"/>), the offerer MUST
                establish a DTLS association. If the offerer becomes DTLS server, it MUST wait for the answerer
                to establish the DTLS association.
            </t>
            <t>
                If the answer does not establish a new DTLS association, the offerer will continue using the
                previously established DTLS association.
            </t>
            <t>
                NOTE: New DTLS association can be established based on changes in either offer or answer SDP.
                When communicating with legacy end points, offerer can receive the answer that uses the same
                fingerprint values and negotiate the same setup roles. The new DTLS association MUST still be
                established if such an answer was received as a response to an offer which requested to establish
                a new DTLS association.
            </t>
            <t>
                NOTE: If the setup role negotiated as a result of the offer/answer transaction is 'holdconn', new
                DTLS association MUST never be established even if other criteria for setting up a new DTLS association,
                such as fingerprint value change, are satisfied, and previously established DTLS association MUST continue
                to be used.
            </t>
        </section>
        <section title="Modifying the Session">
            <t>
                When the offerer sends a subsequent offer, and if the offerer wants to establish a new
                DTLS association, the offerer MUST insert an SDP 'setup' attribute
                according to the procedures in <xref format="default" pageno="false" target="RFC4145"/>, and
                one or more SDP 'fingerprint' attributes according to the procedures in <xref format="default"
                pageno="false" target="RFC4572"/> and <xref format="default" pageno="false" target="I-D.ietf-mmusic-4572-update"/>.
                In addition, offerer MUST insert in the offer an SDP 'dtls-id' attribute with a new unique value
                for the offer fingerprint set. If the fingerprint set is not unique due the certificate reuse across
                multiple SDP sessions or endpoints, the 'dtls-id' attribute value MUST be generated in a way that
                guarantees uniqueness across all current DTLS association established using this fingerprint set,
                including DTLS association established by other SDP sessions or other endpoints.
             </t>
             <t>
                When the offerer sends a subsequent offer, and the offerer does not want to establish
                a new DTLS association, and if a previously established DTLS association exists, the
                offerer MUST insert an SDP 'dtls-id' attribute with the previously assigned value in the offer.
                In addition, the offerer MUST insert an SDP 'setup' attribute with a value that does
                not change the previously negotiated DTLS roles, and one or more SDP 'fingerprint' attributes with
                values that do not change the previously sent fingerprints, in the offer.
            </t>
             <t>
                Furthermore, when the offerer sends a subsequent offer, and the offerer does not want to establish
                a new DTLS association, if a previously established DTLS association exists, and if the offerer wants
                to prevent the answerer from establishing a new DTLS association, the offerer MUST insert an SDP 'setup'
                attribute with the value 'holdconn' in the offer.
            </t>
            <t>
                NOTE: When a new DTLS association is being established, each endpoint needs to be prepared to receive
                data on both the new and old DTLS associations as long as both are alive.
            </t>
        </section>
	</section>

    <section title="ICE Considerations" anchor="sec-dtls-reest-ice">
        <t>
            When the Interactive Connectivity Establishment (ICE) mechansim
            <xref format="default" pageno="false" target="I-D.ietf-ice-rfc5245bis"/> is used, the
            ICE connectivity checks are performed before the DTLS
            handshake begins. Note that if aggressive nomination mode is used,
            multiple candidate pairs may be marked valid before ICE finally
            converges on a single candidate pair.
        </t>
        <t>
            NOTE: Aggressive nomination has been deprecated from ICE, but must still be
            supported for backwards compatibility reasons.
        </t>
        <t>
            When new DTLS association is established over an unordered transport, in order to
            disambiguate any packets associated with the newly established DTLS association, at least
            one of the endpoints MUST allocate a completely new set of ICE candidates which
            were not recently used for any other DTLS association. This means the answerer
            cannot initiate a new DTLS association unless the offerer initiated ICE restart
            <xref format="default" pageno="false" target="I-D.ietf-ice-rfc5245bis"/>. If offerer
            did not initiate ICE restart, it MUST insert SDP 'setup' attribute with the value
            'holdconn'. This will indicate to the answerer, that if it wants to initiate a new 
            DTLS association, it needs to initiate an ICE restart and a new offer/answer exchange
            on its own. However, an ICE restart does not by default require a new DTLS association
            to be established.
        </t>
        <t>
            NOTE: Simple Traversal of the UDP Protocol through NAT (STUN) packets are sent directly
            over UDP, not over DTLS. <xref format="default" pageno="false" target="RFC5764"/> describes
            how to demultiplex STUN packets from DTLS packets and SRTP packets.
        </t>
        <t>
            Each ICE candidate associated with a component is treated as being part of the
            same DTLS association. Therefore, from a DTLS perspective it is not considered
            a change of local transport parameters when an endpoint switches between those
            ICE candidates.
        </t>
    </section>

    <section title="Transport Protocol Considerations" anchor="sec-dtls-cons-trans">
        <section title="Transport Re-Usage" anchor="sec-dtls-cons-trans-reuse">
            <t>
                If DTLS is transported on top of a connection-oriented transport protocol (e.g., TCP or SCTP),
                where all IP packets are acknowledged, all DTLS packets associated with a previous
                DTLS association MUST be acknowledged (or timed out) before a new DTLS association
                can be established on the same transport.
            </t>
        </section>
    </section>

    <section title="SIP Considerations">
        <t>
            When the Session Initiation Protocol (SIP) <xref format="default" pageno="false"
            target="RFC3261"/> is used as the signal protocol for establishing a multimedia
            session, dialogs <xref format="default" pageno="false" target="RFC3261"/> might be
            established between the caller and multiple callees. This is referred to as forking.
            If forking occurs, separate DTLS associations MUST be established between the caller
            and each callee.
        </t>
		    <t>
            It is possible to send an INVITE request which does not contain an SDP offer. Such
            an INVITE request is often referred to as an 'empty INVITE', or an 'offer-less INVITE'.
            The receiving endpoint will include the SDP offer in a response to the request.
            When the endpoint generates such SDP offer, if a previously established
            DTLS association exists, the offerer SHOULD insert an SDP 'dtls-id'
            attribute, and one or more SDP 'fingerprint' attributes, with previously assigned
            attribute values. If a previously established DTLS association did not exists,
            the offer SHOULD be generated based on the same rules as a new offer <xref target="sec-oa-offer"/>.
            Regardless of the previous existence of a DTLS association, the SDP 'setup' attribute
            MUST be included with the value 'actpass' and if ICE is used, ICE restart MUST be initiated.
        </t>
	</section>


    <section title="RFC Updates">
        <section title="General">
            <t>
                This section updates specifications that use DTLS-protected media, in
                order to reflect the procedures defined in this specification.
            </t>
        </section>
        <section title="Update to RFC 5763">
            <figure>
                <artwork align="left" alt="" height="" name="" type="" width="" xml:space="preserve"><![CDATA[

Update to section 5:
--------------------

OLD TEXT:

5.  Establishing a Secure Channel

   The two endpoints in the exchange present their identities as part of
   the DTLS handshake procedure using certificates.  This document uses
   certificates in the same style as described in "Connection-Oriented
   Media Transport over the Transport Layer Security (TLS) Protocol in
   the Session Description Protocol (SDP)" [RFC4572].

   If self-signed certificates are used, the content of the
   subjectAltName attribute inside the certificate MAY use the uniform
   resource identifier (URI) of the user.  This is useful for debugging
   purposes only and is not required to bind the certificate to one of
   the communication endpoints.  The integrity of the certificate is
   ensured through the fingerprint attribute in the SDP.  The
   subjectAltName is not an important component of the certificate
   verification.

   The generation of public/private key pairs is relatively expensive.
   Endpoints are not required to generate certificates for each session.

   The offer/answer model, defined in [RFC3264], is used by protocols
   like the Session Initiation Protocol (SIP) [RFC3261] to set up
   multimedia sessions.  In addition to the usual contents of an SDP
   [RFC4566] message, each media description ("m=" line and associated
   parameters) will also contain several attributes as specified in
   [RFC5764], [RFC4145], and [RFC4572].

   When an endpoint wishes to set up a secure media session with another
   endpoint, it sends an offer in a SIP message to the other endpoint.
   This offer includes, as part of the SDP payload, the fingerprint of
   the certificate that the endpoint wants to use.  The endpoint SHOULD
   send the SIP message containing the offer to the offerer's SIP proxy
   over an integrity protected channel.  The proxy SHOULD add an
   Identity header field according to the procedures outlined in
   [RFC4474].  The SIP message containing the offer SHOULD be sent to
   the offerer's SIP proxy over an integrity protected channel.  When
   the far endpoint receives the SIP message, it can verify the identity
   of the sender using the Identity header field.  Since the Identity
   header field is a digital signature across several SIP header fields,
   in addition to the body of the SIP message, the receiver can also be
   certain that the message has not been tampered with after the digital
   signature was applied and added to the SIP message.

   The far endpoint (answerer) may now establish a DTLS association with
   the offerer.  Alternately, it can indicate in its answer that the
   offerer is to initiate the TLS association.  In either case, mutual
   DTLS certificate-based authentication will be used.  After completing
   the DTLS handshake, information about the authenticated identities,
   including the certificates, are made available to the endpoint
   application.  The answerer is then able to verify that the offerer's
   certificate used for authentication in the DTLS handshake can be
   associated to the certificate fingerprint contained in the offer in
   the SDP.  At this point, the answerer may indicate to the end user
   that the media is secured.  The offerer may only tentatively accept
   the answerer's certificate since it may not yet have the answerer's
   certificate fingerprint.

   When the answerer accepts the offer, it provides an answer back to
   the offerer containing the answerer's certificate fingerprint.  At
   this point, the offerer can accept or reject the peer's certificate
   and the offerer can indicate to the end user that the media is
   secured.

   Note that the entire authentication and key exchange for securing the
   media traffic is handled in the media path through DTLS.  The
   signaling path is only used to verify the peers' certificate
   fingerprints.

   The offer and answer MUST conform to the following requirements.

   o  The endpoint MUST use the setup attribute defined in [RFC4145].
      The endpoint that is the offerer MUST use the setup attribute
      value of setup:actpass and be prepared to receive a client_hello
      before it receives the answer.  The answerer MUST use either a
      setup attribute value of setup:active or setup:passive.  Note that
      if the answerer uses setup:passive, then the DTLS handshake will
      not begin until the answerer is received, which adds additional
      latency. setup:active allows the answer and the DTLS handshake to
      occur in parallel.  Thus, setup:active is RECOMMENDED.  Whichever
      party is active MUST initiate a DTLS handshake by sending a
      ClientHello over each flow (host/port quartet).

   o  The endpoint MUST NOT use the connection attribute defined in
      [RFC4145].

   o  The endpoint MUST use the certificate fingerprint attribute as
      specified in [RFC4572].

   o  The certificate presented during the DTLS handshake MUST match the
      fingerprint exchanged via the signaling path in the SDP.  The
      security properties of this mechanism are described in Section 8.

   o  If the fingerprint does not match the hashed certificate, then the
      endpoint MUST tear down the media session immediately.  Note that
      it is permissible to wait until the other side's fingerprint has
      been received before establishing the connection; however, this
      may have undesirable latency effects.


NEW TEXT:

5.  Establishing a Secure Channel

   The two endpoints in the exchange present their identities as part of
   the DTLS handshake procedure using certificates.  This document uses
   certificates in the same style as described in "Connection-Oriented
   Media Transport over the Transport Layer Security (TLS) Protocol in
   the Session Description Protocol (SDP)" [RFC4572].

   If self-signed certificates are used, the content of the
   subjectAltName attribute inside the certificate MAY use the uniform
   resource identifier (URI) of the user.  This is useful for debugging
   purposes only and is not required to bind the certificate to one of
   the communication endpoints.  The integrity of the certificate is
   ensured through the fingerprint attribute in the SDP.

   The generation of public/private key pairs is relatively expensive.
   Endpoints are not required to generate certificates for each session.

   The offer/answer model, defined in [RFC3264], is used by protocols
   like the Session Initiation Protocol (SIP) [RFC3261] to set up
   multimedia sessions.

   When an endpoint wishes to set up a secure media session with another
   endpoint, it sends an offer in a SIP message to the other endpoint.
   This offer includes, as part of the SDP payload, a fingerprint of
   a certificate that the endpoint wants to use.  The endpoint SHOULD
   send the SIP message containing the offer to the offerer's SIP proxy
   over an integrity protected channel.  The proxy SHOULD add an
   Identity header field according to the procedures outlined in
   [RFC4474].  The SIP message containing the offer SHOULD be sent to
   the offerer's SIP proxy over an integrity protected channel.  When
   the far endpoint receives the SIP message, it can verify the identity
   of the sender using the Identity header field.  Since the Identity
   header field is a digital signature across several SIP header fields,
   in addition to the body of the SIP message, the receiver can also be
   certain that the message has not been tampered with after the digital
   signature was applied and added to the SIP message.

   The far endpoint (answerer) may now establish a DTLS association with
   the offerer.  Alternately, it can indicate in its answer that the
   offerer is to initiate the DTLS association.  In either case, mutual
   DTLS certificate-based authentication will be used.  After completing
   the DTLS handshake, information about the authenticated identities,
   including the certificates, are made available to the endpoint
   application.  The answerer is then able to verify that the offerer's
   certificate used for authentication in the DTLS handshake can be
   associated to the certificate fingerprint contained in the offer in
   the SDP.  At this point, the answerer may indicate to the end user
   that the media is secured.  The offerer may only tentatively accept
   the answerer's certificate since it may not yet have the answerer's
   certificate fingerprint.

   When the answerer accepts the offer, it provides an answer back to
   the offerer containing the answerer's certificate fingerprint.  At
   this point, the offerer can accept or reject the peer's certificate
   and the offerer can indicate to the end user that the media is
   secured.

   Note that the entire authentication and key exchange for securing the
   media traffic is handled in the media path through DTLS.  The
   signaling path is only used to verify the peers' certificate
   fingerprints.

   The offerer and answerer MUST follow the SDP offer/answer procedures
   defined in [RFCXXXX].


Update to section 6.6:
----------------------

OLD TEXT:

6.6.  Session Modification

   Once an answer is provided to the offerer, either endpoint MAY
   request a session modification that MAY include an updated offer.
   This session modification can be carried in either an INVITE or
   UPDATE request.  The peers can reuse the existing associations if
   they are compatible (i.e., they have the same key fingerprints and
   transport parameters), or establish a new one following the same
   rules are for initial exchanges, tearing down the existing
   association as soon as the offer/answer exchange is completed.  Note
   that if the active/passive status of the endpoints changes, a new
   connection MUST be established.

NEW TEXT:

6.6.  Session Modification

   Once an answer is provided to the offerer, either endpoint MAY
   request a session modification that MAY include an updated offer.
   This session modification can be carried in either an INVITE or
   UPDATE request. The peers can reuse an existing DTLS association,
   or establish a new one, following the procedures in [RFCXXXX].

Update to section 6.7.1:
------------------------

OLD TEXT:

6.7.1.  ICE Interaction

   Interactive Connectivity Establishment (ICE), as specified in
   [RFC5245], provides a methodology of allowing participants in
   multimedia sessions to verify mutual connectivity.  When ICE is being
   used, the ICE connectivity checks are performed before the DTLS
   handshake begins.  Note that if aggressive nomination mode is used,
   multiple candidate pairs may be marked valid before ICE finally
   converges on a single candidate pair.  Implementations MUST treat all
   ICE candidate pairs associated with a single component as part of the
   same DTLS association.  Thus, there will be only one DTLS handshake
   even if there are multiple valid candidate pairs.  Note that this may
   mean adjusting the endpoint IP addresses if the selected candidate
   pair shifts, just as if the DTLS packets were an ordinary media
   stream.

   Note that Simple Traversal of the UDP Protocol through NAT (STUN)
   packets are sent directly over UDP, not over DTLS.  [RFC5764]
   describes how to demultiplex STUN packets from DTLS packets and SRTP
   packets.

NEW TEXT:

6.7.1.  ICE Interaction

   The Interactive Connectivity Establishment (ICE) [RFC5245]
   considerations for DTLS-protected media are described in
   [RFCXXXX].
                ]]></artwork>
            </figure>
        </section>
        <section title="Update to RFC 7345">
            <figure>
                <artwork align="left" alt="" height="" name="" type="" width="" xml:space="preserve"><![CDATA[

Update to section 4:
--------------------

OLD TEXT:

4.  SDP Offerer/Answerer Procedures

4.1.  General

   An endpoint (i.e., both the offerer and the answerer) MUST create an
   SDP media description ("m=" line) for each UDPTL-over-DTLS media
   stream and MUST assign a UDP/TLS/UDPTL value (see Table 1) to the
   "proto" field of the "m=" line.

   The procedures in this section apply to an "m=" line associated with
   a UDPTL-over-DTLS media stream.

   In order to negotiate a UDPTL-over-DTLS media stream, the following
   SDP attributes are used:

   o  The SDP attributes defined for UDPTL over UDP, as described in
      [ITU.T38.2010]; and

   o  The SDP attributes, defined in [RFC4145] and [RFC4572], as
      described in this section.

   The endpoint MUST NOT use the SDP "connection" attribute [RFC4145].

   In order to negotiate the TLS roles for the UDPTL-over-DTLS transport
   connection, the endpoint MUST use the SDP "setup" attribute
   [RFC4145].

   If the endpoint supports, and is willing to use, a cipher suite with
   an associated certificate, the endpoint MUST include an SDP
   "fingerprint" attribute [RFC4572].  The endpoint MUST support SHA-256
   for generating and verifying the SDP "fingerprint" attribute value.
   The use of SHA-256 is preferred.  UDPTL over DTLS, at a minimum, MUST
   support TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 and MUST support
   TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256.  UDPTL over DTLS MUST prefer
   TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 and any other Perfect Forward
   Secrecy (PFS) cipher suites over non-PFS cipher suites.
   Implementations SHOULD disable TLS-level compression.

   If a cipher suite with an associated certificate is selected during
   the DTLS handshake, the certificate received during the DTLS
   handshake MUST match the fingerprint received in the SDP
   "fingerprint" attribute.  If the fingerprint does not match the
   hashed certificate, then the endpoint MUST tear down the media
   session immediately.  Note that it is permissible to wait until the
   other side's fingerprint has been received before establishing the
   connection; however, this may have undesirable latency effects.

4.2.  Generating the Initial Offer

   The offerer SHOULD assign the SDP "setup" attribute with a value of
   "actpass", unless the offerer insists on being either the sender or
   receiver of the DTLS ClientHello message, in which case the offerer
   can use either a value of "active" (the offerer will be the sender of
   ClientHello) or "passive" (the offerer will be the receiver of
   ClientHello).  The offerer MUST NOT assign an SDP "setup" attribute
   with a "holdconn" value.

   If the offerer assigns the SDP "setup" attribute with a value of
   "actpass" or "passive", the offerer MUST be prepared to receive a
   DTLS ClientHello message before it receives the SDP answer.

4.3.  Generating the Answer

   If the answerer accepts the offered UDPTL-over-DTLS transport
   connection, in the associated SDP answer, the answerer MUST assign an
   SDP "setup" attribute with a value of either "active" or "passive",
   according to the procedures in [RFC4145].  The answerer MUST NOT
   assign an SDP "setup" attribute with a value of "holdconn".

   If the answerer assigns an SDP "setup" attribute with a value of
   "active" value, the answerer MUST initiate a DTLS handshake by
   sending a DTLS ClientHello message on the negotiated media stream,
   towards the IP address and port of the offerer.

4.4.  Offerer Processing of the Answer

   When the offerer receives an SDP answer, if the offerer ends up being
   active it MUST initiate a DTLS handshake by sending a DTLS
   ClientHello message on the negotiated media stream, towards the IP
   address and port of the answerer.

4.5.  Modifying the Session

   Once an offer/answer exchange has been completed, either endpoint MAY
   send a new offer in order to modify the session.  The endpoints can
   reuse the existing DTLS association if the key fingerprint values and
   transport parameters indicated by each endpoint are unchanged.
   Otherwise, following the rules for the initial offer/answer exchange,
   the endpoints can negotiate and create a new DTLS association and,
   once created, delete the previous DTLS association, following the
   same rules for the initial offer/answer exchange.  Each endpoint
   needs to be prepared to receive data on both the new and old DTLS
   associations as long as both are alive.

NEW TEXT:

4.  SDP Offerer/Answerer Procedures

   An endpoint (i.e., both the offerer and the answerer) MUST create an
   SDP media description ("m=" line) for each UDPTL-over-DTLS media
   stream and MUST assign a UDP/TLS/UDPTL value (see Table 1) to the
   "proto" field of the "m=" line.

   The offerer and answerer MUST follow the SDP offer/answer procedures
   defined in [RFCXXXX] in order to negotiate the DTLS association
   associated with the UDPTL-over-DTLS media stream. In addition,
   the offerer and answerer MUST use the SDP attributes defined for
   UDPTL over UDP, as defined in [ITU.T38.2010].


Update to section 5.2.1:
------------------------

OLD TEXT:

5.2.1.  ICE Usage

   When Interactive Connectivity Establishment (ICE) [RFC5245] is being
   used, the ICE connectivity checks are performed before the DTLS
   handshake begins.  Note that if aggressive nomination mode is used,
   multiple candidate pairs may be marked valid before ICE finally
   converges on a single candidate pair.  User Agents (UAs) MUST treat
   all ICE candidate pairs associated with a single component as part of
   the same DTLS association.  Thus, there will be only one DTLS
   handshake even if there are multiple valid candidate pairs.  Note
   that this may mean adjusting the endpoint IP addresses if the
   selected candidate pair shifts, just as if the DTLS packets were an
   ordinary media stream.  In the case of an ICE restart, the DTLS
   handshake procedure is repeated, and a new DTLS association is
   created.  Once the DTLS handshake is completed and the new DTLS
   association has been created, the previous DTLS association is
   deleted.


NEW TEXT:

5.2.1.  ICE Usage

   The Interactive Connectivity Establishment (ICE) [RFC5245]
   considerations for DTLS-protected media are described in
   [RFCXXXX].

                ]]></artwork>
            </figure>
        </section>
	</section>

	<section title="Security Considerations">
		<t>
			This specification does not modify the security considerations associated with DTLS, or
            the SDP offer/answer mechanism. In addition to the introduction of the SDP
            'dtls-id' attribute, the specification simply clarifies the procedures for
            negotiating and establishing a DTLS association.
		</t>
	</section>

	<section anchor="section.iana" title="IANA Considerations">
        <t>
            This document updates the "Session Description Protocol Parameters" registry
            as specified in Section 8.2.2 of <xref target="RFC4566" pageno="false" format="default"/>.
            Specifically, it adds the SDP dtls-id attribute to the table for SDP
            media level attributes.
        </t>
        <figure>
			<artwork align="left"><![CDATA[

    Attribute name: dtls-id
    Type of attribute: media-level
    Subject to charset: no
    Purpose: Indicate whether a new DTLS association is to be
     established/re-established.
    Appropriate Values: see Section 4
    Contact name: Christer Holmberg
    Mux Category: IDENTICAL

			]]></artwork>
		</figure>
	</section>

	<section title="Acknowledgements">
		<t>
      Thanks to Justin Uberti, Martin Thomson, Paul Kyzivat, Jens Guballa,
      Charles Eckel and Gonzalo Salgueiro for providing comments and
      suggestions on the document.
    </t>
	</section>

	<section title="Change Log">
		<t>[RFC EDITOR NOTE: Please remove this section when publishing]</t>
      <t>Changes from draft-ietf-mmusic-sdp-dtls-14
        <list style="symbols">
            <t>Changes based on comments from Flemming:</t>
            <t>- Additional dtls-is clarifiations</t>
            <t>- Editorial fixes</t>
        </list>
        </t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-13
            <list style="symbols">
                <t>Text about the updated RFCs added to Abstract and Introduction</t>
                <t>Reference to RFC 5763 removed from section 6 (ICE Considerations)</t>
                <t>Reference to RFC 5763 removed from section 8 (SIP Considerations)</t>
            </list>
        </t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-12
            <list style="symbols">
                <t>"unreliable" changed to "unordered"</t>
            </list>
        </t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-11
            <list style="symbols">
                <t>Attribute name changed to dtls-id</t>
                <t>Additional text based on comments from Roman Shpount.</t>
            </list>
        </t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-10
            <list style="symbols">
                <t>Modified document to use dtls-id instead of dtls-connection</t>
                <t>Changes are based on comments from Eric Rescorla, Justin Uberti, and Paul Kyzivat.</t>
            </list>
        </t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-08
			<list style="symbols">
                <t>Offer/Answer section modified in order to allow sending of multiple SDP 'fingerprint' attributes.</t>
                <t>Terminology made consistent: 'DTLS connection' replaced with 'DTLS association'.</t>
                <t>Editorial changes based on comments from Paul Kyzivat.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-07
			<list style="symbols">
                <t>Reference to RFC 7315 replaced with reference to RFC 7345.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-06
			<list style="symbols">
                <t>Text on restrictions regarding spanning a DTLS association over multiple transports added.</t>
                <t>Mux category added to IANA Considerations.</t>
                <t>Normative text regarding mux category and source-specific applicability added.</t>
                <t>Reference to RFC 7315 added.</t>
                <t>Clarified that offerer/answerer that has not been updated to support this specification will
                not include the dtls-id attribute in offers and answers.</t>
				<t>Editorial corrections based on WGLC comments from Charles Eckel.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-05
			<list style="symbols">
                <t>Text on handling offer/answer error conditions added.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-04
			<list style="symbols">
                <t>Editorial nits fixed based on comments from Paul Kyzivat:</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-03
			<list style="symbols">
                <t>Changes based on comments from Paul Kyzivat:</t>
                <t>- Modification of dtls-id attribute section.</t>
                <t>- Removal of IANA considerations subsection.</t>
                <t>- Making note into normative text in o/a section.</t>
                <t>Changes based on comments from Martin Thompson:</t>
                <t>- Abbreviations section removed.</t>
                <t>- Clarify that a new DTLS association requires a new o/a transaction.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-02
			<list style="symbols">
                <t>- Updated RFCs added to boilerplate.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-01
			<list style="symbols">
                <t>- Annex regarding 'dtls-id-id' attribute removed.</t>
                <t>- Additional SDP offer/answer procedures, related to certificates, added.</t>
                <t>- Updates to RFC 5763 and RFC 7345 added.</t>
                <t>- Transport protocol considerations added.</t>
			</list>
		</t>
        <t>Changes from draft-ietf-mmusic-sdp-dtls-00
			<list style="symbols">
                <t>- SDP 'connection' attribute replaced with new 'dtls-id' attribute.</t>
                <t>- IANA Considerations added.</t>
                <t>- E-mail regarding 'dtls-id-id' attribute added as Annex.</t>
			</list>
		</t>
        <t>Changes from draft-holmberg-mmusic-sdp-dtls-01
			<list style="symbols">
                <t>- draft-ietf-mmusic version of draft submitted.</t>
                <t>- Draft file name change (sdp-dtls -> dtls-sdp) due to collision with another expired draft.</t>
                <t>- Clarify that if ufrag in offer is unchanged, it must be unchanged in associated answer.</t>
                <t>- SIP Considerations section added.</t>
                <t>- Section about multiple SDP fingerprint attributes added.</t>
			</list>
		</t>
        <t>Changes from draft-holmberg-mmusic-sdp-dtls-00
			<list style="symbols">
                <t>- Editorial changes and clarifications.</t>
			</list>
		</t>

	</section>
</middle>

<back>
    <references title="Normative References">
		    <?rfc include="reference.RFC.2119"?>
        <?rfc include="reference.RFC.3261"?>
		    <?rfc include="reference.RFC.3264"?>
        <?rfc include="reference.RFC.4145"?>
        <?rfc include="reference.RFC.4566"?>
        <?rfc include="reference.RFC.4572"?>
        <?rfc include="reference.RFC.5763"?>
        <?rfc include="reference.RFC.7345"?>
        <?rfc include="reference.I-D.draft-ietf-mmusic-4572-update-07"?>
    </references>
    <references title="Informative References">
        <?rfc include="reference.RFC.5576"?>
        <?rfc include="reference.RFC.5764"?>
		    <?rfc include="reference.RFC.6083"?>
        <?rfc include="reference.I-D.draft-ietf-ice-rfc5245bis-04"?>
        <?rfc include="reference.I-D.draft-ietf-mmusic-sdp-mux-attributes-14"?>
        <?rfc include="reference.I-D.draft-ietf-mmusic-sdp-bundle-negotiation-35"?>
    </references>

</back>
</rfc>
